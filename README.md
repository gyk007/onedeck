# ONEDECK (Микросервисный фронтенд)

##### Фреймвор ONEDECK позволяет легко писать микросервисы во фронтенде.
##### В рамках данного фреймворка микросервис для фронтенда назывется модуль.

## Модуль (микросервис, фрагмент)

Модуль - независимая, логически законченая еденица приложения, которая инкапсулирует в себе всю логику.

- Может быть написан c помощью любого фреймворка ([Vue][vue], [React][react], [Angular][angular], [Webix][webix] ... );

- Можно легко собрать отдельно от всего приложения;

- Динамически импортируется;

## Виды модулей
Все модули за исключением Root модуля наследуются от базового класса `onedeck.Module`.
Root модуль наследуется от базового класса `onedeck.RootModule`.

- **Root Module** Главный модуль приложения. Инициализируется один раз при старте приложения и инициализирует все модули приложения. Все модули общаются между собой через Root модуль с помощью событий. Реализует паттерн [Медиатор][mediator].
- **Page Module** Модуль страницы. Инициализируется при переходе на страницу модуля. Каждый модуль страницы соответствует конкретному url адресу. Может встраиваться в модуль макета (Layout module) и содержать в себе встраиваемые модули (Embed Module)
- **Global Module** Глобальный модуль (глобальные модальные окна, нотификации). Инициализируется один раз при старте приложения. Может вызываться из любой точки приложения. Может содержать в себе Embed модули.
- **Layout Module** Модуль макета (header, footer).  Инициализируется при переходе на страницу, если еще не был проинициализирован на предыдущей странице. Представляет собой контейнер для встраивания Page модуля и для встраивания Embed модулей страницы.
- **Embed Module** Встраиваемый модуль. Инициализируется при переходе на страницу модуля Page либо при инициализации Global модуля. Представляет собой логически законченную часть, которая может быть встроена в различные модули приложения.

## Пример внутреннего устройства

```
|--project_name_dir
    |--src
        |--modules
            |--Root
                |--root.js
                ...
            |--Module1
                |--module.js
                ...
            |--Module2
                |--module.js
                ...
            ...
```
Имя модуля начинается с заглавной буквы. Название директории модуля должно соотвествовать названию модуля.

## Конфигурация приложения
При старте приложнеия приосиходит инициализация модуля Root, который в свою очередь динамически импортирует необходимые модули и инициализирует их.

#### Старт приложения (index.js):
```
import Config from './conf';
new Config.rootModule(Config);
```
#### Конфиг файл
```
import Root from 'Root/module';

export default {
  // роутинг с помощю history Api  или hash
  historyApi: false,
  // корневой путь для приложения ('/example/path/')
  rootPath: '/',
  // класс Root модуля
  rootModule: Root,
  // название модуля главной страницы
  mainModule: 'main',
  // названия модуля старницы 404
  module404: 'notfound',
  // функция для динамического импорта модуля
  // module - название модуля и название директории модуля
  import: async (module) => await import(`./modules/${module}/module`),
  modules: {
    auth: {
      module: 'ExampleAuth',
    },
    main: {
      layout: 'ExampleLayoutWebix',
      module: 'ExampleWebix',
      embed: {
        example: {
          module: 'ExampleEmbed',
        },
      },
    },
    notfound: {
      layout: 'ExampleLayoutWebix',
      module: 'ExampleError404',
    },
    globalwnd: {
      global: true,
      module: 'ExampleGlobalWnd',
      embed: {
        example: {
          module: 'ExampleEmbedGlobal',
        },
      },
    },
    globalnotification: {
      global: true,
      module: 'ExampleNotification',
    },
  },
};
```
Конфигурация может содеражть любые поля, в зваисимости от необходимости.
##### Обязательные поля конфигурации приложения
- **`historyApi: Bool`** - вид роутинга в приложении
-  **`rootPath: String`** - начальный роут. Если наше приложение стартует от пути `http://localhost:3000/example/path/` - в `rootPath` необходимо указать `/example/path/`;
-  **`rootModule: Class`** - класс Root модуля
-  **`mainModule: String`** - название модуля главной старницы
-  **`module404: String`** - название модуля старницы 404
-  **`import: Function`** - ассинхронная функция котора динамически импортирует все модули
-  **`modules: Object`** - объект который содержит насторйки всех модулей
##### Конфигурация модуля
```
main: {
  layout: 'ExampleLayoutWebix',
  module: 'ExampleWebix',
  embed: {
    example: {
      module: 'ExampleEmbed',
    },
  },
},
```
Конфигурация модуля может содержать любые поля, в зваисимости от необходимости.
- **ключ объекта конфигурации `main`**- название модуля, и данное название соответсвует url модуля `http://localhost:3000/main/`
- **`module: String`** - Обязательное поле. Содержит название модуля. Модуль должен находиться в директории с соответсвующим названием.
- **`layout: String`** - Необязательное поле. Содержит название модуля Layout. Модуль должен находиться в директории с соответсвующим названием.
- **`embed: Object`** - Необязательное поле. Содержит Embed модули. Модуль должен находиться в директории с соответсвующим названием, которое указано в поле  `module` .

[webix]: https://webix.com/
[vue]: https://vuejs.org/
[quasar]: https://quasar.dev/
[react]: https://reactjs.org/
[angular]: https://angular.io/
[mediator]: https://refactoring.guru/ru/design-patterns/mediator
[observer]: https://refactoring.guru/ru/design-patterns/observer
[rout]: https://developer.mozilla.org/ru/docs/Web/API/History_API
